# ğŸTiny Snake Sensor Forwarder

## é¡¹ç›®ç®€ä»‹

æœ¬é¡¹ç›®ä¸ºå¾®å‹ç”Ÿå‘½æ¢æµ‹æœºå™¨äººé¡¹ç›®çš„å­é¡¹ç›®ï¼Œç›®çš„åœ¨äºé©±åŠ¨ä¼ æ„Ÿå™¨å¹¶å°†å…¶é€šè¿‡ç½‘ç»œæ‰“åŒ…å‘é€ä¼šè¿œç¨‹åœ°é¢ç«™ã€‚é¡¹ç›®è®¾è®¡çš„æœºå™¨äººå¤–è§‚ä¸ºè›‡å‹æœºå™¨äººï¼Œè›‡å¤´ä½ç½®é…å¤‡æ‘„åƒå¤´ã€æ¿€å…‰é›·è¾¾ã€IMUä¸‰ç§ä¼ æ„Ÿå™¨è®¾å¤‡ã€‚

é€šä¿¡çš„æ€»ä½“æ¶æ„ä¸ºå‘å¸ƒè€…-è®¢é˜…è€…æ¶æ„ï¼Œæœºå™¨äººä¸ºå‘å¸ƒè€…ï¼Œé‡‡é›†æ•°æ®åè¿›è¡Œå‘å¸ƒï¼Œåœ°é¢ç«™æ˜¯è®¢é˜…è€…ï¼Œè´Ÿè´£æ¥æ”¶æ¶ˆæ¯ã€‚ç”±äºé¡¹ç›®æ•´ä½“é™åˆ¶ä¼ è¾“å¸¦å®½ï¼Œå› æ­¤æœ¬é¡¹ç›®é™¤ IMU ä¹‹å¤–çš„æ‰€æœ‰æ•°æ®éƒ½è¿›è¡Œäº†å‹ç¼©å¤„ç†ã€‚ç‚¹äº‘è¿›è¡Œäº†ä¸€å®šæ¯”ä¾‹çš„é™é‡‡æ ·ï¼Œè§†é¢‘è¿›è¡Œç¡¬ä»¶åŠ é€Ÿçš„ jpeg ç¼–ç ã€‚

æœºå™¨äººä½¿ç”¨çš„å¼€å‘æ¿å‹å·ä¸º **RaspberryPi Zero 2W**ï¼Œä½¿ç”¨åŸºäº aarch64(armv8) Debian12(bookwarm) çš„æ ‘è“æ´¾å®šåˆ¶æ“ä½œç³»ç»Ÿ

## é¡¹ç›®æ–‡ä»¶è¯´æ˜

- `.devcontainer`: ç”¨äºå­˜æ”¾åŸºäº vscode çš„å®¹å™¨å¼€å‘é…ç½®
  - `pub`: publisher å®¹å™¨é…ç½®ï¼Œå®é™…éƒ¨ç½²åœ¨æœºå™¨äººçš„å¼€å‘æ¿ä¸Š
  - `sub`: subscriber å®¹å™¨é…ç½®ï¼Œå®é™…éƒ¨ç½²åœ¨åœ°é¢ç«™ä¸Š
- `cache`: ç”¨äºå¼€å®¹å™¨çš„æ„é€ ç»“æœï¼Œè¯·å‹¿æ‰‹åŠ¨æ›´æ”¹å†…éƒ¨æ–‡ä»¶å†…å®¹
- `data`: å­˜æ”¾æµ‹è¯•æ•°æ®
- `docker`: å­˜æ”¾é•œåƒé…ç½®æ–‡ä»¶ï¼Œæ¯ä¸ªé•œåƒéƒ½æœ‰ä¸‰ä¸ªé˜¶æ®µã€‚base é˜¶æ®µå®‰è£…ä¾èµ–ï¼Œoverlay é˜¶æ®µç¼–è¯‘é¡¹ç›®ä»£ç ï¼Œdev é˜¶æ®µé…ç½®å¼€å‘ç¯å¢ƒ
  - `publisher.Dockerfile`: ä¸º publisher é…ç½®çš„é•œåƒ
  - `subscriber.Dockerfile`: ä¸º subscriber è®¾è®¡çš„é•œåƒ
- `projs`: å­˜æ”¾é¡¹ç›®ä»£ç 
  - `publisher`: å‘å¸ƒè€…ä»£ç ï¼Œéƒ¨ç½²åœ¨æœºå™¨äººä¸Š
  - `subscriber`: è®¢é˜…è€…ä»£ç 
- `docker-compose.yml`: æœåŠ¡é…ç½®æ–‡ä»¶

## é¡¹ç›®æ‰“åŒ…æ–¹æ³•

ä½¿ç”¨ä¸‹é¢çš„æŒ‡ä»¤å¯¹é¡¹ç›®è¿›è¡Œæ‰“åŒ…

```shell
export projdir=$(basename $(pwd)) \
&& cd .. \
&& tar czfv tinysk-neo-air.tar.gz \
    --exclude=cache/publisher/* \
    --exclude=cache/subscriber/build/* \
    --exclude=cache/subscriber/devel/* \
    --exclude=projs/publisher/.vscode \
    --exclude=projs/publisher/.devcontainer \
    --exclude=projs/publisher/build \
     $projdir \
&& cd $projdir \
&& mv ../tinysk-neo-air.tar.gz . \
&& unset projdir
```

## ä½¿ç”¨æ–¹æ³•

### å…‹éš†é¡¹ç›®

```bash
git clone --recurse-submodules https://github.com/HopeCollector/TinySnakeSensorForwarder.git
```

è‹¥å·²ç»å…‹éš†äº†é¡¹ç›®ï¼Œå¯ä»¥åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ

```bash
git submodule update --init --recursive
```

### æ„å»ºé¡¹ç›®

#### å…¨é‡æ„å»º

åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œä¸‹é¢æŒ‡ä»¤å°†æ„å»ºæ‰€æœ‰æœåŠ¡ï¼Œè¿™ä¸ªä¼šéå¸¸æ…¢

```bash
docker compose build
```

### å¯åŠ¨ç‰¹å®šæœåŠ¡

æœåŠ¡è¿è¡Œä¾èµ– `tinysk.yml` é…ç½®æ–‡ä»¶ï¼Œå¯åŠ¨ä¸‹é¢æœåŠ¡å‰éœ€è¦å…ˆè°ƒæ•´é…ç½®

```bash
# å¯åŠ¨å‘å¸ƒç«¯ï¼Œè‹¥æ²¡æœ‰æå‰æ„å»ºé•œåƒï¼Œè¿™ä¸ªå¯åŠ¨ä¼šéå¸¸æ…¢
docker compose up pub_run

# å¯åŠ¨è®¢é˜…ç«¯
docker compose up sub_run
```

## äºŒæ¬¡å¼€å‘

1. åœ¨ vscode ä¸­æ‰“å¼€æœ¬é¡¹ç›®
2. å®‰è£…æ’ä»¶
   1. ms-azuretools.vscode-docker
   2. ms-vscode-remote.remote-containers
3. é‡å¯ vscodeï¼Œæ­¤æ—¶çª—å£å³ä¸‹è§’ä¼šæé†’æ˜¯å¦åœ¨å®¹å™¨ä¸­é‡æ–°æ‰“å¼€ ![reopen in container](imgs/README/image.png)
4. é€‰æ‹©é‡æ–°æ‰“å¼€åä¼šè¦æ±‚é€‰æ‹©å¼€å¯å“ªä¸ªé¡¹ç›® ![choose continer](imgs/README/image-1.png)
5. é€‰æ‹©è¦å¼€å‘çš„é¡¹ç›®åä¼š vscode ä¼šé‡å¯ï¼Œå¹¶è¿›å…¥ç›¸å…³çš„å¼€å‘å®¹å™¨
